class Search{constructor(){this.params={query:"",limit:10,sort:"confidence"},this.els={container:document.querySelector(".container"),form:document.querySelector("form"),input:document.querySelector("input"),close:document.querySelector(".close"),collapseIcon:"",sortSelect:document.querySelector("select")},this.vals={original:"",queryArray:[]},this.getFromLS(),this.setCloseState(),this.AEL(),this.collapse()}decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}setCloseState(){null==this.els.input.value||void 0==this.els.input.value||""==this.els.input.value?this.els.close.style.display="none":this.els.close.style.display="block"}getFromLS(){if(!localStorage.getItem("query"))return;const t=localStorage.getItem("query");this.els.input.value=JSON.parse(t)[0],this.fetchData(JSON.parse(t)[0])}saveToStorage(t=""){this.vals.queryArray=[t],localStorage.setItem("query",JSON.stringify(this.vals.queryArray)),this.fetchData(JSON.parse(localStorage.getItem("query"))[0])}fetchData(t=""){t&&""!=t&&fetch(`https://www.reddit.com/search.json?limit=${this.params.limit}&q=${encodeURI(t)}&sort=${this.params.sort}`).then(t=>{if(t.ok)return t}).then(t=>t).then(t=>t.json()).then(t=>t.data.children).then(t=>{t.forEach((t,e)=>{1==e?this.els.container.innerHTML=this.textDefault(t):this.els.container.innerHTML+=this.textDefault(t)})}).catch(t=>this.err=t)}textDefault(t){return`\n    <section class="post">\n      <span class="score d-block">\n      <img src="img/updoot.png" width="15" style="margin-right: .25em; transform: translate(2px, -1px);">\n      ${t.data.score.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}\n      </span>\n\n      <a data-target="_blank" rel="nofollow noopener noreferrer" href="https://reddit.com/u/${t.data.author}">u/${t.data.author}</a>:\n\n      "${t.data.title}"\n          <span class="info d-block my-2">\n            <a href="https://reddit.com/${t.data.subreddit_name_prefixed}" data-target="_blank"  rel="nofollow noopener noreferrer">${t.data.subreddit_name_prefixed}</a>\n\n            &mdash;\n\n            <a data-target="_blank" rel="nofollow noopener noreferrer" href="https://reddit.com${t.data.permalink}">Comments</a>\n          </span>\n\n\n          <span class="text-warning gold ${0!=t.data.gilded?"d-block":"d-none"}">\n            ${0!=t.data.gilded?t.data.gilded:""} &times;\n          </span>\n\n        ${this.thisText(t)}\n        ${this.preview(t.data.preview,t.data.url,t.data)}\n\n    </section>`}thisText(t){return t.data.thistext_html?`\n      <div class="self-text">\n      <button class="collapse-icon btn btn-none self-text-btn"></button>\n      <span class="text">${this.decodeHtml(t.data.thistext_html)}</span>\n      </div>`:""}AEL(){this.els.form.addEventListener("submit",t=>{this.els.container.innerHTML="",this.getData(t)}),this.getData=this.getData.bind(this),this.els.input.addEventListener("keyup",t=>{this.setCloseState(),"ontouchstart"in window||this.getData(t)}),this.els.close.addEventListener("click",t=>this.resetData(t)),this.resetData=this.resetData.bind(this),this.els.sortSelect.addEventListener("change",t=>this.sortChange(t)),this.sortChange=this.sortChange.bind(this)}sortChange(){this.params.sort=this.options[this.selectedIndex].value,this.fetchData(this.els.input.value)}getData(t){t.keyCode>36&&t.keyCode<41||32==t.keyCode||91==t.keyCode||9==t.keyCode||2==t.keyCode||t.keyCode>15&&t.keyCode<21||(this.vals.original.length>512?this.els.container.innerHTML="<h1>Query may not be longer than 512 characters</h1>":(t.preventDefault(),document.querySelector(".container").innerHTML="",this.vals.original=this.els.input.value,this.fetchData(this.vals.original),this.saveToStorage(this.vals.original)))}resetData(t){this.els.form.reset(),this.els.container.innerHTML="",t.target.style.display="none",this.params.sort="confidence",this.els.input.focus(),this.saveToStorage()}collapse(){this.els.collapseIcon=document.querySelectorAll(".collapse-icon"),this.els.container.addEventListener("click",t=>{t.target.classList.contains("collapse-icon")&&(t.target.parentElement.classList.toggle("open"),t.target.classList.contains("gif-toggle")?"mp4"==t.target.dataset.type&&(t.target.nextElementSibling.innerHTML=`\n          <video playsinline autoplay controls heigth="${t.target.dataset.ht}" width="${t.target.dataset.wt}">\n          <source src="${t.target.dataset.url}" type="video/mp4">\n          </video>\n          `):"gif"==t.target.dataset.type&&(t.target.nextElementSibling.innerHTML=`<img heigth="${t.target.dataset.ht}" width="${t.target.dataset.wt} src="${t.target.dataset.url}" type="image/gif">`))})}preview(t,e,a){if(!t)return"";if(t.images[0].variants.mp4){const e=t.images[0].variants.mp4.source,{ht:a,wt:s,url:n}={ht:e.height,wt:e.width,url:e.url};return`<div class="self-text">\n        <button class="collapse-icon btn btn-none gif-toggle" data-ht="${a}" data-wt="${s}" data-url="${n}" data-type="mp4"></button>\n      <span class="text"></span>\n      </div>`}if(t.images[0].variants.gif){const e=t.images[0].variants.gif.source,{ht:a,wt:s,url:n}={ht:e.height,wt:e.width,url:e.url};return`<div class="slef-text">\n      <button class="collapse-icon btn btn-none gif-toggle" data-ht="${a}" data-wt="${s}" data-url="${n}" data-type="gif"></button>\n      <span class="text"></span>\n      </div>`}const s=t.images[0].source,{ht:n,url:i}={ht:s.height,url:s.url};return`\n    <a data-target="_blank" class="post-link" rel="nofollow noopener noreferrer" href="${e}">\n      <img class="thumb-img" src="${i}" style="max-height: ${`${n/9*16}px`}" class="d-block mx-auto">\n      <p class="img-domain">${a.domain}</p>\n    </a>`}}new Search;
//# sourceMappingURL=bundle.js.map
