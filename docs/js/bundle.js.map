{"version":3,"sources":["main.js"],"names":["_this","Search","[object Object]","this","params","query","limit","sort","els","container","document","querySelector","form","input","close","collapseIcon","sortSelect","vals","original","queryArray","getFromLS","setCloseState","AEL","collapse","html","txt","createElement","innerHTML","value","undefined","style","display","localStorage","getItem","JSON","parse","fetchData","setItem","stringify","requestQuery","fetch","encodeURI","then","res","ok","console","error","blob","json","data","children","iter","forEach","textDefault","catch","err","info","score","toString","replace","author","title","subreddit_name_prefixed","permalink","gilded","selfText","preview","url","arg","selftext_html","decodeHtml","addEventListener","e","getData","window","resetData","sortChange","options","selectedIndex","keyCode","length","preventDefault","saveToStorage","reset","target","focus","querySelectorAll","classList","contains","parentElement","toggle","dataset","type","nextElementSibling","ht","wt","ar","link","images","variants","mp4","image","source","height","width","gif","domain"],"mappings":"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","file":"bundle.js","sourcesContent":["// if ('serviceWorker' in navigator) {\n//   window.addEventListener('load', function() {\n//     navigator.serviceWorker.register('./sw.js').then(function(registration) {\n//       // Registration was successful\n//       console.log('ServiceWorker registration successful with scope: ', registration.scope);\n//     }, function(err) {\n//       // registration failed :(\n//       console.log('ServiceWorker registration failed: ', err);\n//     });\n//   });\n// } else {\n// \tconsole.log('Service worker not supported!')\n// }\n// commented out due to console errors\n\nlet _this\nclass Search {\n  constructor() {\n\n    _this = this\n\n    this.params = {\n      query: '',\n      limit: 10,\n      sort: 'confidence'\n    }\n\n    // elements\n    this.els = {\n      container: document.querySelector('.container'),\n      form: document.querySelector('form'),\n      input: document.querySelector('input'),\n      close: document.querySelector('.close'),\n      collapseIcon: '', // will be added when searched\n      sortSelect: document.querySelector('select')\n    }\n\n    this.vals = {\n      original: '',\n      queryArray: []\n    }\n\n    // functions\n\n    this.getFromLS() // LS = localStorage\n    this.setCloseState()\n    this.AEL() // add event listeners\n    this.collapse()\n\n\n  }\n\n  decodeHtml(html) { //\n    var txt = document.createElement(\"textarea\");\n    txt.innerHTML = html;\n    return txt.value;\n  }\n\n  setCloseState() {\n    this.els.input.value == null ||\n      this.els.input.value == undefined ||\n      this.els.input.value == '' ? this.els.close.style.display = 'none' :\n      this.els.close.style.display = 'block';\n  }\n\n  getFromLS() {\n    if (!localStorage.getItem('query')) return;\n\n    _this.els.input.value = JSON.parse(localStorage.getItem('query'))[0]\n    _this.fetchData(JSON.parse(localStorage.getItem('query'))[0])\n\n  }\n\n  saveToStorage(query = '') {\n    _this.vals.queryArray = [query]\n    localStorage.setItem('query', JSON.stringify(_this.vals.queryArray))\n\n    _this.fetchData((JSON.parse(localStorage.getItem('query'))[0]))\n  }\n\n  fetchData(requestQuery = '') {\n    if (!requestQuery || requestQuery == '') return\n\n    fetch(`https://www.reddit.com/search.json?limit=${this.params.limit}&q=${encodeURI(requestQuery)}&sort=${_this.params.sort}`)\n      .then(res => {\n        if (!res.ok) {\n          console.error('Bad Request')\n          return;\n        }\n        return res\n      })\n      .then(blob => {\n        return blob\n      })\n      .then(blob => blob.json())\n      .then(blob => blob.data.children)\n      .then(blob => {\n        let iter = 0\n        blob.forEach(res => {\n          iter++\n          if (iter == 1) {\n            _this.els.container.innerHTML = _this.textDefault(res)\n          } else {\n            _this.els.container.innerHTML += _this.textDefault(res)\n          }\n        })\n      })\n      .catch(err => console.info(err));\n  }\n\n  textDefault(res) {\n    return `\n    <section class=\"post\">\n      <span class=\"score d-block\">\n      <img src=\"img/updoot.png\" width=\"15\" style=\"margin-right: .25em; transform: translate(2px, -1px);\">\n      ${res.data.score.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")}\n      </span>\n\n      <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com/u/${res.data.author}\">u/${res.data.author}</a>:\n\n      \"${res.data.title}\"\n          <span class=\"info d-block my-2\">\n            <a href=\"https://reddit.com/${res.data.subreddit_name_prefixed}\" data-target=\"_blank\"  rel=\"nofollow noopener noreferrer\">${res.data.subreddit_name_prefixed}</a>\n\n            &mdash;\n\n            <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com${res.data.permalink}\">Comments</a>\n          </span>\n\n\n          <span class=\"text-warning gold ${res.data.gilded != 0 ? 'd-block' : 'd-none'}\">\n            ${res.data.gilded != 0 ? res.data.gilded : ''} &times;\n          </span>\n\n        ${_this.selfText(res)}\n        ${_this.preview(res.data.preview, res.data.url, res.data)}\n\n    </section>`\n  }\n\n\n  selfText(arg) {\n    if (!arg.data.selftext_html) return ''\n\n    return `\n      <div class=\"self-text\">\n      <button class=\"collapse-icon btn btn-none self-text-btn\"></button>\n      <span class=\"text\">${this.decodeHtml(arg.data.selftext_html)}</span>\n      </div>`\n  }\n\n  AEL() {\n    _this.els.form.addEventListener('submit', e => {\n      _this.els.container.innerHTML = ''\n      _this.getData(e)\n    })\n    _this.els.input.addEventListener('keyup', e => {\n      _this.setCloseState()\n      if ('ontouchstart' in window) return;\n      _this.getData(e)\n    })\n    _this.els.close.addEventListener('click', _this.resetData)\n\n    _this.els.sortSelect.addEventListener('change', _this.sortChange)\n  }\n  sortChange() {\n    _this.params.sort = this.options[this.selectedIndex].value\n    _this.fetchData(_this.els.input.value)\n  }\n\n  getData(e) {\n\n    if ((e.keyCode > 36 && e.keyCode < 41) ||\n      e.keyCode == 32 ||\n      e.keyCode == 91 ||\n      e.keyCode == 9 ||\n      e.keyCode == 2 ||\n      (e.keyCode > 15 && e.keyCode < 21)) return;\n    if (_this.vals.original.length > 512) {\n      container.innerHTML = '<h1>Query may not be longer than 512 characters</h1>';\n      return;\n    }\n\n    e.preventDefault()\n    document.querySelector('.container').innerHTML = ''\n    _this.vals.original = _this.els.input.value\n\n    _this.fetchData(_this.vals.original)\n    _this.saveToStorage(_this.vals.original)\n\n  }\n\n  resetData(e) {\n    _this.els.form.reset()\n    _this.els.container.innerHTML = '';\n    e.target.style.display = 'none';\n    _this.params.sort = 'confidence';\n    _this.els.input.focus()\n    _this.saveToStorage()\n  }\n\n\n  collapse() {\n    _this.els.collapseIcon = document.querySelectorAll('.collapse-icon')\n\n    _this.els.container.addEventListener('click', e => {\n\n      if (e.target.classList.contains('collapse-icon')) {\n        e.target.parentElement.classList.toggle('open')\n\n        if (e.target.classList.contains('gif-toggle')) {\n          if (e.target.dataset.type == 'mp4') {\n            e.target.nextElementSibling.innerHTML = `\n          <video playsinline autoplay controls heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt}\">\n          <source src=\"${e.target.dataset.url}\" type=\"video/mp4\">\n          </video>\n          `\n          }\n        } else if (e.target.dataset.type == 'gif') {\n          e.target.nextElementSibling.innerHTML = `<img heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt} src=\"${e.target.dataset.url}\" type=\"image/gif\">`\n        }\n      }\n\n    })\n    return;\n  }\n\n  preview(ar, link, res) {\n    if (!ar) return '';\n    if (ar.images[0].variants.mp4) {\n      let image = ar.images[0].variants.mp4.source\n      const ht = image.height\n      const wt = image.width\n      const url = image.url\n\n      return `\n      <div class=\"self-text\">\n        <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"mp4\"></button>\n      <span class=\"text\"></span>\n      </div>\n      `\n    } else if (ar.images[0].variants.gif) {\n      let image = ar.images[0].variants.gif.source\n      const ht = image.height\n      const wt = image.width\n      const url = image.url\n\n      return `\n      <div class=\"self-text\">\n      <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"gif\"></button>\n      <span class=\"text\"></span>\n      </div>\n      `\n    }\n\n\n\n    let image = ar.images[0].source\n\n    const ht = image.height\n    const wt = image.width + 'px'\n    const url = image.url\n\n    return `\n    <a data-target=\"_blank\" class=\"post-link\" rel=\"nofollow noopener noreferrer\" href=\"${link}\">\n      <img class=\"thumb-img\" src=\"${url}\" style=\"max-height: ${((ht / 9) * 16) + 'px'}\" class=\"d-block mx-auto\">\n      <p class=\"img-domain\">${res.domain}</p>\n    </a>`\n  }\n}\n\nnew Search\n"]}