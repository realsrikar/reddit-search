{"version":3,"sources":["main.js"],"names":["navigator","window","addEventListener","serviceWorker","register","then","registration","console","log","scope","err","Search","_classCallCheck","this","params","query","limit","sort","els","container","document","querySelector","form","input","close","collapseIcon","sortSelect","vals","original","queryArray","getFromLS","setCloseState","AEL","collapse","html","txt","createElement","innerHTML","value","undefined","style","display","localStorage","getItem","LSQuery","JSON","parse","fetchData","arguments","length","setItem","stringify","_this","requestQuery","fetch","encodeURI","res","ok","blob","json","data","children","forEach","iter","textDefault","catch","score","toString","replace","author","title","subreddit_name_prefixed","permalink","gilded","thisText","preview","url","arg","thistext_html","decodeHtml","_this2","e","blur","getData","resetData","sortChange","options","selectedIndex","keyCode","preventDefault","saveToStorage","reset","target","focus","querySelectorAll","classList","contains","parentElement","toggle","dataset","type","nextElementSibling","ht","wt","ar","link","images","variants","mp4","image","source","_ht$wt$url","height","width","gif","_ht$wt$url2","_ht$url","domain"],"mappings":"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","file":"bundle.js","sourcesContent":["if ('serviceWorker' in navigator) {\n  window.addEventListener('load', function() {\n    navigator.serviceWorker.register('./sw.js').then(function(registration) {\n      // Registration was successful\n      console.log('ServiceWorker registration successful with scope: ', registration.scope);\n    }, function(err) {\n      // registration failed :(\n      console.log('ServiceWorker registration failed: ', err);\n    });\n  });\n} else {\n console.log('Service worker not supported!')\n}\n// commented out due to console errors\n\nclass Search {\n  constructor() {\n\n    this.params = {\n      query: '',\n      limit: 10,\n      sort: 'confidence',\n    }\n\n    // elements\n    this.els = {\n      container: document.querySelector('.container'),\n      form: document.querySelector('form'),\n      input: document.querySelector('input'),\n      close: document.querySelector('.close'),\n      collapseIcon: '', // will be added when searched\n      sortSelect: document.querySelector('select'),\n    }\n\n    this.vals = {\n      original: '',\n      queryArray: [],\n    }\n\n    // functions\n\n    this.getFromLS() // LS = localStorage\n    this.setCloseState()\n    this.AEL() // add event listeners\n    this.collapse()\n  }\n\n  decodeHtml(html) { //\n    const txt = document.createElement('textarea');\n    txt.innerHTML = html;\n    return txt.value;\n  }\n\n  setCloseState() {\n    if (this.els.input.value == null ||\n      this.els.input.value == undefined ||\n      this.els.input.value == '') {\n      this.els.close.style.display = 'none'\n    } else {\n      this.els.close.style.display = 'block';\n    }\n  }\n\n  getFromLS() {\n    if (!localStorage.getItem('query')) return;\n\n    const LSQuery = localStorage.getItem('query')\n\n    this.els.input.value = JSON.parse(LSQuery)[0]\n\n    this.fetchData(JSON.parse(LSQuery)[0])\n  }\n\n  saveToStorage(query = '') {\n    this.vals.queryArray = [query]\n    localStorage.setItem('query', JSON.stringify(this.vals.queryArray))\n\n    this.fetchData((JSON.parse(localStorage.getItem('query'))[0]))\n  }\n\n  fetchData(requestQuery = '') {\n    if (!requestQuery || requestQuery == '') return\n\n    fetch(`https://www.reddit.com/search.json?limit=${this.params.limit}&q=${encodeURI(requestQuery)}&sort=${this.params.sort}`)\n      .then(res => {\n        if (!res.ok) {\n          return;\n        }\n        return res\n      })\n      .then(blob => blob)\n      .then(blob => blob.json())\n      .then(blob => blob.data.children)\n      .then(blob => {\n        blob.forEach((res, iter) => {\n          if (iter == 1) {\n            this.els.container.innerHTML = this.textDefault(res)\n          } else {\n            this.els.container.innerHTML += this.textDefault(res)\n          }\n        })\n      })\n      .catch(err => this.err = err);\n  }\n\n  textDefault(res) {\n    return `\n    <section class=\"post\">\n      <span class=\"score d-block\">\n      <img src=\"img/updoot.png\" width=\"15\" style=\"margin-right: .25em; transform: translate(2px, -1px);\">\n      ${res.data.score.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\n      </span>\n\n      <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com/u/${res.data.author}\">u/${res.data.author}</a>:\n\n      \"${res.data.title}\"\n          <span class=\"info d-block my-2\">\n            <a href=\"https://reddit.com/${res.data.subreddit_name_prefixed}\" data-target=\"_blank\"  rel=\"nofollow noopener noreferrer\">${res.data.subreddit_name_prefixed}</a>\n\n            &mdash;\n\n            <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com${res.data.permalink}\">Comments</a>\n          </span>\n\n\n          <span class=\"text-warning gold ${res.data.gilded != 0 ? 'd-block' : 'd-none'}\">\n            ${res.data.gilded != 0 ? res.data.gilded : ''} &times;\n          </span>\n\n        ${this.thisText(res)}\n        ${this.preview(res.data.preview, res.data.url, res.data)}\n\n    </section>`\n  }\n\n\n  thisText(arg) {\n    if (!arg.data.thistext_html) return ''\n\n    return `\n      <div class=\"self-text\">\n      <button class=\"collapse-icon btn btn-none self-text-btn\"></button>\n      <span class=\"text\">${this.decodeHtml(arg.data.thistext_html)}</span>\n      </div>`\n  }\n\n  AEL() {\n    this.els.form.addEventListener('submit', e => {\n      this.els.container.innerHTML = ''\n      this.setCloseState()\n      this.els.input.blur()\n      this.getData(e)\n    })\n\n    this.els.input.addEventListener('keyup', e => {\n      this.setCloseState()\n      if ('ontouchstart' in window) return;\n      this.getData(e)\n    })\n\n    this.els.close.addEventListener('click', e => this.resetData(e))\n    this.els.sortSelect.addEventListener('change', e => this.sortChange(e))\n  }\n  sortChange() {\n    this.params.sort = this.options[this.selectedIndex].value\n    this.fetchData(this.els.input.value)\n  }\n\n  getData(e) {\n    if ((e.keyCode > 36 && e.keyCode < 41) ||\n      e.keyCode == 32 ||\n      e.keyCode == 91 ||\n      e.keyCode == 9 ||\n      e.keyCode == 2 ||\n      (e.keyCode > 15 && e.keyCode < 21)) return;\n    if (this.vals.original.length > 512) {\n      this.els.container.innerHTML = '<h1>Query may not be longer than 512 characters</h1>';\n      return;\n    }\n\n    e.preventDefault()\n    this.vals.original = this.els.input.value\n\n    this.fetchData(this.vals.original)\n    this.saveToStorage(this.vals.original)\n  }\n\n  resetData(e) {\n    this.els.form.reset()\n    this.els.container.innerHTML = '';\n    e.target.style.display = 'none';\n    this.params.sort = 'confidence';\n    this.els.input.focus()\n    this.saveToStorage()\n  }\n\n\n  collapse() {\n    this.els.collapseIcon = document.querySelectorAll('.collapse-icon')\n\n    this.els.container.addEventListener('click', e => {\n      if (e.target.classList.contains('collapse-icon')) {\n        e.target.parentElement.classList.toggle('open')\n\n        if (e.target.classList.contains('gif-toggle')) {\n          if (e.target.dataset.type == 'mp4') {\n            e.target.nextElementSibling.innerHTML = `\n          <video playsinline autoplay controls heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt}\">\n          <source src=\"${e.target.dataset.url}\" type=\"video/mp4\">\n          </video>\n          `\n          }\n        } else if (e.target.dataset.type == 'gif') {\n          e.target.nextElementSibling.innerHTML = `<img heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt} src=\"${e.target.dataset.url}\" type=\"image/gif\">`\n        }\n      }\n    })\n  }\n\n  preview(ar, link, res) {\n    if (!ar) return '';\n    if (ar.images[0].variants.mp4) {\n      const image = ar.images[0].variants.mp4.source\n\n      const { ht, wt, url } = { ht: image.height, wt: image.width, url: image.url }\n\n\n      return `<div class=\"self-text\">\n        <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"mp4\"></button>\n      <span class=\"text\"></span>\n      </div>`\n    } else if (ar.images[0].variants.gif) {\n      const image = ar.images[0].variants.gif.source\n\n\n      const { ht, wt, url } = { ht: image.height, wt: image.width, url: image.url }\n\n      return `<div class=\"slef-text\">\n      <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"gif\"></button>\n      <span class=\"text\"></span>\n      </div>`\n    }\n\n\n    const image = ar.images[0].source\n\n    const { ht, url } = { ht: image.height, url: image.url }\n\n    return `\n    <a data-target=\"_blank\" class=\"post-link\" rel=\"nofollow noopener noreferrer\" href=\"${link}\">\n      <img class=\"thumb-img\" src=\"${url}\" style=\"max-height: ${`${(ht / 9) * 16}px`}\" class=\"d-block mx-auto\">\n      <p class=\"img-domain\">${res.domain}</p>\n    </a>`\n  }\n}\n\nnew Search\n"]}