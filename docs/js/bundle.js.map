{"version":3,"sources":["main.js"],"names":["navigator","window","addEventListener","serviceWorker","register","then","console","log","e","html","String","raw","Search","_classCallCheck","this","params","query","limit","sort","els","container","document","querySelector","form","input","close","collapseIcon","sortSelect","vals","original","queryArray","getFromLS","setCloseState","AEL","collapse","pram","txt","createElement","innerHTML","value","undefined","style","display","localStorage","getItem","LSQuery","JSON","parse","fetchData","arguments","length","setItem","stringify","_this","requestQuery","fetch","encodeURI","res","ok","blob","json","data","children","forEach","iter","textDefault","catch","err","_templateObject","score","toString","replace","author","title","subreddit_name_prefixed","permalink","gilded","thisText","preview","url","arg","thistext_html","_templateObject2","decodeHtml","_this2","blur","getData","resetData","sortChange","target","options","selectedIndex","keyCode","preventDefault","saveToStorage","reset","focus","querySelectorAll","classList","contains","parentElement","toggle","dataset","type","nextElementSibling","_templateObject3","ht","wt","_templateObject4","ar","link","images","variants","mp4","image","source","_ht$wt$url","height","width","_templateObject5","gif","_ht$wt$url2","_templateObject6","_ht$url","_templateObject7","domain"],"mappings":"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","file":"bundle.js","sourcesContent":["if ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('./sw.js')\n      .then(() => {\n        console.log('thanks');\n      }, e => console.log(e))\n  })\n}\n\nconst html = String.raw\n\nclass Search {\n  constructor() {\n\n    this.params = {\n      query: '',\n      limit: 10,\n      sort: 'confidence',\n    }\n\n    // elements\n    this.els = {\n      container: document.querySelector('.container'),\n      form: document.querySelector('form'),\n      input: document.querySelector('input'),\n      close: document.querySelector('.close'),\n      collapseIcon: '', // will be added when searched\n      sortSelect: document.querySelector('select'),\n    }\n\n    this.vals = {\n      original: '',\n      queryArray: [],\n    }\n\n    // functions\n\n    this.getFromLS() // LS = localStorage\n    this.setCloseState()\n    this.AEL() // add event listeners\n    this.collapse()\n  }\n\n  decodeHtml(pram) {\n    const txt = document.createElement('textarea');\n    txt.innerHTML = pram;\n    return txt.value;\n  }\n\n  setCloseState() {\n    if (this.els.input.value == null ||\n      this.els.input.value == undefined ||\n      this.els.input.value == '') {\n      this.els.close.style.display = 'none'\n    } else {\n      this.els.close.style.display = 'block';\n    }\n  }\n\n  getFromLS() {\n    if (!localStorage.getItem('query')) return;\n\n    const LSQuery = localStorage.getItem('query')\n\n    this.els.input.value = JSON.parse(LSQuery)[0]\n\n    this.fetchData(JSON.parse(LSQuery)[0])\n  }\n\n  saveToStorage(query = '') {\n    this.vals.queryArray = [query]\n    localStorage.setItem('query', JSON.stringify(this.vals.queryArray))\n\n    this.fetchData((JSON.parse(localStorage.getItem('query'))[0]))\n  }\n\n  fetchData(requestQuery = '') {\n    if (!requestQuery || requestQuery == '') return\n\n    fetch(`https://www.reddit.com/search.json?limit=${this.params.limit}&q=${encodeURI(requestQuery)}&sort=${this.params.sort}`)\n      .then(res => {\n        if (!res.ok) {\n          return;\n        }\n        return res\n      })\n      .then(blob => blob)\n      .then(blob => blob.json())\n      .then(blob => blob.data.children)\n      .then(blob => {\n        blob.forEach((res, iter) => {\n          if (iter == 1) {\n            this.els.container.innerHTML = this.textDefault(res)\n          } else {\n            this.els.container.innerHTML += this.textDefault(res)\n          }\n        })\n      })\n      .catch(err => this.err = err);\n  }\n\n  textDefault(res) {\n    return html `\n    <section class=\"post\">\n      <span class=\"score d-block\">\n      <img src=\"img/updoot.png\" width=\"15\" style=\"margin-right: .25em; transform: translate(2px, -1px);\">\n      ${res.data.score.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\n      </span>\n\n      <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com/u/${res.data.author}\">u/${res.data.author}</a>:\n\n      \"${res.data.title}\"\n          <span class=\"info d-block my-2\">\n            <a href=\"https://reddit.com/${res.data.subreddit_name_prefixed}\" data-target=\"_blank\"  rel=\"nofollow noopener noreferrer\">${res.data.subreddit_name_prefixed}</a>\n\n            &mdash;\n\n            <a data-target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://reddit.com${res.data.permalink}\">Comments</a>\n          </span>\n\n\n          <span class=\"text-warning gold ${res.data.gilded != 0 ? 'd-block' : 'd-none'}\">\n            ${res.data.gilded != 0 ? res.data.gilded : ''} &times;\n          </span>\n\n        ${this.thisText(res)}\n        ${this.preview(res.data.preview, res.data.url, res.data)}\n\n    </section>`\n  }\n\n\n  thisText(arg) {\n    if (!arg.data.thistext_html) return ''\n\n    return html `\n      <div class=\"self-text\">\n      <button class=\"collapse-icon btn btn-none self-text-btn\"></button>\n      <span class=\"text\">${this.decodeHtml(arg.data.thistext_html)}</span>\n      </div>`\n  }\n\n  AEL() {\n    this.els.form.addEventListener('submit', e => {\n      this.els.container.innerHTML = ''\n      this.setCloseState()\n      this.els.input.blur()\n      this.getData(e)\n    })\n\n    this.els.input.addEventListener('keyup', e => {\n      this.setCloseState()\n      if ('ontouchstart' in window) return;\n      this.getData(e)\n    })\n\n    this.els.close.addEventListener('click', e => this.resetData(e))\n    this.els.sortSelect.addEventListener('change', e => this.sortChange(e))\n  }\n  sortChange(e) {\n    this.params.sort = e.target.options[e.target.selectedIndex].value\n    this.fetchData(this.els.input.value)\n  }\n\n  getData(e) {\n    if ((e.keyCode > 36 && e.keyCode < 41) ||\n      e.keyCode == 32 ||\n      e.keyCode == 91 ||\n      e.keyCode == 9 ||\n      e.keyCode == 2 ||\n      (e.keyCode > 15 && e.keyCode < 21)) return;\n    if (this.vals.original.length > 512) {\n      this.els.container.innerHTML = '<h1>Query may not be longer than 512 characters</h1>';\n      return;\n    }\n\n    e.preventDefault()\n    this.vals.original = this.els.input.value\n\n    this.fetchData(this.vals.original)\n    this.saveToStorage(this.vals.original)\n  }\n\n  resetData(e) {\n    this.els.form.reset()\n    this.els.container.innerHTML = '';\n    e.target.style.display = 'none';\n    this.params.sort = 'confidence';\n    this.els.input.focus()\n    this.saveToStorage()\n  }\n\n\n  collapse() {\n    this.els.collapseIcon = document.querySelectorAll('.collapse-icon')\n\n    this.els.container.addEventListener('click', e => {\n      if (e.target.classList.contains('collapse-icon')) {\n        e.target.parentElement.classList.toggle('open')\n\n        if (e.target.classList.contains('gif-toggle')) {\n          if (e.target.dataset.type == 'mp4') {\n            e.target.nextElementSibling.innerHTML = html`\n          <video playsinline autoplay controls heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt}\">\n          <source src=\"${e.target.dataset.url}\" type=\"video/mp4\">\n          </video>\n          `\n          }\n        } else if (e.target.dataset.type == 'gif') {\n          e.target.nextElementSibling.innerHTML =html`\n          <img heigth=\"${e.target.dataset.ht}\" width=\"${e.target.dataset.wt} src=\"${e.target.dataset.url}\" type=\"image/gif\" />`\n        }\n      }\n    })\n  }\n\n  preview(ar, link, res) {\n    if (!ar) return '';\n    if (ar.images[0].variants.mp4) {\n      const image = ar.images[0].variants.mp4.source\n\n      const {\n        ht,\n        wt,\n        url\n      } = {\n        ht: image.height,\n        wt: image.width,\n        url: image.url\n      }\n\n\n      return html `<div class=\"self-text\">\n        <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"mp4\"></button>\n      <span class=\"text\"></span>\n      </div>`\n    } else if (ar.images[0].variants.gif) {\n      const image = ar.images[0].variants.gif.source\n\n\n      const {\n        ht,\n        wt,\n        url\n      } = {\n        ht: image.height,\n        wt: image.width,\n        url: image.url\n      }\n\n      return html `<div class=\"slef-text\">\n      <button class=\"collapse-icon btn btn-none gif-toggle\" data-ht=\"${ht}\" data-wt=\"${wt}\" data-url=\"${url}\" data-type=\"gif\"></button>\n      <span class=\"text\"></span>\n      </div>`\n    }\n\n\n    const image = ar.images[0].source\n\n    const {\n      ht,\n      url\n    } = {\n      ht: image.height,\n      url: image.url\n    }\n\n    return html `\n    <a data-target=\"_blank\" class=\"post-link\" rel=\"nofollow noopener noreferrer\" href=\"${link}\">\n      <img class=\"thumb-img\" src=\"${url}\" style=\"max-height: ${`${(ht / 9) * 16}px`}\" class=\"d-block mx-auto\">\n      <p class=\"img-domain\">${res.domain}</p>\n    </a>`\n  }\n}\n\nnew Search"]}